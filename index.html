<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>NGL Viewer Test Phase</title>

        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="bootstrap.min.css">
        <script src="ngl.js"></script>
        
        <style>

            body, .ngl-card {
                background-color: #111111;
                color: white;
            }

            canvas, .ngl-card {
                border: 1px solid whitesmoke;
            }

            #modelViewport {
                margin-bottom: 30px !important;
            }

            .ngl-heading, .card-header {
                margin-top: 20px;
            }


        </style>
    </head>
    <body>
        
        <div class="container text-center ngl-heading">
          <h1 class="display">NGL Viewer</h1>
            <div class="card my-3 ngl-card">
                <div class="card-header">
                    <h2 id="modelName">5MZA</h2>
                    <!-- <div class="btn-group btn-group-lg" role="group" aria-label="Select Model">
                        <button type="button" class="btn btn-info">5MZA</button>
                        <button type="button" class="btn btn-info">Model 1 Repair</button>
                    </div> -->
                </div>
                <div class="card-body">
                    <div id="modelViewport" style="width: 600px; height: 450px; margin: auto;">
                        <a role="button" href="ngl-data.zip" class="btn btn-info" style="top: 250px; right: 51px; position: absolute; z-index: 10"><svg style="position:relative;bottom:0.1rem;" width="1rem" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="white" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"/></svg> Download Data</a>
                    </div>
                </div>
            </div>
        </div>


        <script>
            // Create NGL Stage object
            var stage = new NGL.Stage("modelViewport", {backgroundColor: '#20214'});

            // Handle window resizing
            window.addEventListener("resize", function (event) {
                stage.handleResize();
            }, false);

            // Code for : interactive-viewer
            function addElement(el) {
                Object.assign(el.style, {
                    position: "absolute",
                    zIndex: 10
                });
                stage.viewer.container.appendChild(el);
            }

            function createElement(name, properties, style) {
                var el = document.createElement(name);
                Object.assign(el, properties);
                Object.assign(el.style, style);
                return el;
            }

            function createSelect(options, properties, style) {
                var select = createElement("select", properties, style);
                options.forEach(function (d) {
                    select.add(createElement("option", {
                        value: d[0], text: d[1]
                    }))
                });
                return select
            }

            function loadStructure(input) {
                stage.removeAllComponents();
                return stage.loadFile(input, {ext: 'pdb'}).then(function (o) {
                    o.autoView();
                    o.addRepresentation(polymerSelect.value, {
                        sele: "all",
                        name: "all",
                        colorScheme: "atomindex"
                    });
                    // o.addRepresentation("spacefill", {
                    //         sele: "ligand",
                    //         aspectRatio: 3.0
                    //     }
                    // );
                })
            }

            // Representation Menu
            addElement(createElement("span", {
              innerText: "Representation: "
            }, { top: '120px', left: "20px" }))

            var polymerSelect = createSelect([
                ["cartoon", "Cartoon"],
                ["ribbon", "Ribbon"],
                ["rope", "Rope"],
                ["tube", "Tube"],
                ["trace", "Trace"],
                ["backbone", "Backbone"],
                ["line", "Lines"],
                ["ball+stick", "Ball & Stick"],
                ["licorice", "Licorice"],
                ["hyperball", "Hyperball"],
                ["surface", "Surface"],
                ["spacefill", "Spacefill"],
                ["helixorient", "Helixorient"],
                ["point", "Point"],
                ["rocket", "Rocket"],
                ["label", "Label"]
            ], {
                onchange: function (e) {
                    stage.getRepresentationsByName("all").dispose();
                    stage.eachComponent(function (o) {
                        o.addRepresentation(e.target.value, {
                            sele: "all",
                            name: "all",
                            colorScheme: colorSelect.value
                        })
                    })
                }
            }, {top: "150px", left: "20px"});
            addElement(polymerSelect);

            // Color Menu
            addElement(createElement("span", {
              innerText: "Color by: "
            }, { top: '200px', left: "20px" }))

            // Code to add a uniform color to scheme:
            // var lightgrey = NGL.ColormakerRegistry.addScheme(function (params) {this.atomColor = function (atom) {return 0xCDCDCD }})

            var colorSelect = createSelect([
              ['atomindex', 'Atom Index'],
              ['bfactor', 'B Factor'],
              ['chainid', 'Chain ID'],
              ['chainindex', 'Chain Index'],
              ['chainname', 'Chain Name'],
              ['element', 'Element'],
              ['entityindex', 'Entity Index'],
              ['entitytype', 'Entity Type'],
              ['geoquality', 'Geo Quality'],
              ['hydrophobicity', 'Hydrophobicity'],
              ['modelindex', 'Model Index'],
              ['moleculetype', 'Molecule Type'],
              ['occupancy', 'Occupancy'],
              ['random', 'Random'],
              ['residueindex', 'Residue Index'],
              ['resname', 'Residue Name'],
              ['sstruc', 'Secondary Structure'],
              // ['uniform', 'Uniform']
            ], {
              onchange: function(e) {
                stage.getRepresentationsByName("all").dispose();
                stage.eachComponent(function (o) {
                  o.addRepresentation(polymerSelect.value, {
                    sele: 'all',
                    name: 'all',
                    colorScheme: e.target.value
                  })
                })
              }
            }, {top: "230px", left: "20px"});
            addElement(colorSelect);


            // Center Button
            var centerButton = createElement("input", {
                type: "button",
                value: "Center",
                onclick: function () {
                    stage.autoView(1000)
                }
            }, {top: "300px", left: "20px"});
            addElement(centerButton);

            // Spin Button
            var toggle_spin = true;
            var spinButton = createElement("input", {
                type: "button",
                value: "Spin",
                onclick: function () {
                    if (toggle_spin === false) {
                        stage.setSpin(true);
                        toggle_spin = true;
                        stage.setRock(false);
                        toggle_rock = false;
                        
                    } else if (toggle_spin === true) {
                        stage.setSpin(false);
                        toggle_spin = false;
                        console.log(toggle_spin);
                    }
                }
            }, {top: "350px", left: "20px"});
            addElement(spinButton);

            // Rock Button
            var toggle_rock = false;
            var rockButton = createElement("input", {
                type: "button",
                value: "Rock",
                onclick: function () {
                    if (toggle_rock === false) {
                        stage.setRock(true);
                        toggle_rock = true;
                        stage.setSpin(false);
                        toggle_spin = false;
                        
                    } else if (toggle_rock === true) {
                        stage.setRock(false);
                        toggle_rock = false;
                        console.log(toggle_rock);
                    }
                }
            }, {top: "400px", left: "20px"});
            addElement(rockButton);

            loadStructure("5mza.txt");
            stage.setSpin(true);

            addElement(createElement("span", {
              innerText: "Model: "
            }, { top: '120px', right: "157px" }))

            var modelSelect = createSelect([
                ["5mza", "5MZA"],
                ["model1-repair", "Model-1 Repair"],
            ], {
                onchange: function (e) {
                    stage.getRepresentationsByName("all").dispose();
                    loadStructure(modelSelect.value + ".txt")
                    $('#modelName').text($('option[value=' + modelSelect.value + ']').text());
                }
            }, {top: "150px", right: "50px"});
            addElement(modelSelect);

            $('select').addClass('btn btn-primary')
            $('input').addClass('btn btn-danger')

        </script>

    </body>
</html>