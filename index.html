<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>NGL Viewer Test Phase</title>

        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="bootstrap.min.css">
        <script src="ngl.js"></script>
        
        <style>

            body, .ngl-card {
                background-color: #111111;
                color: white;
            }

            canvas, .ngl-card {
                border: 1px solid whitesmoke;
            }

            #modelViewport {
                margin-bottom: 30px !important;
            }

            .ngl-heading {
                margin-top: 40px;
            }

        </style>
    </head>
    <body>
        
        <div class="container text-center ngl-heading">
          <h1 class="display">NGL Viewer</h1>
            <div class="card my-3 ngl-card">
                <div class="card-header">Model-1 Repair</div>
                <div class="card-body">
                    <div id="modelViewport" style="width: 600px; height: 450px; margin: auto;"></div>
                </div>
            </div>
        </div>


        <script>
            // Create NGL Stage object
            var stage = new NGL.Stage("modelViewport", {backgroundColor: '#20214'});

            // Handle window resizing
            window.addEventListener("resize", function (event) {
                stage.handleResize();
            }, false);

            // Code for : interactive-viewer
            function addElement(el) {
                Object.assign(el.style, {
                    position: "absolute",
                    zIndex: 10
                });
                stage.viewer.container.appendChild(el);
            }

            function createElement(name, properties, style) {
                var el = document.createElement(name);
                Object.assign(el, properties);
                Object.assign(el.style, style);
                return el;
            }

            function createSelect(options, properties, style) {
                var select = createElement("select", properties, style);
                options.forEach(function (d) {
                    select.add(createElement("option", {
                        value: d[0], text: d[1]
                    }))
                });
                return select
            }

            function loadStructure(input) {
                stage.removeAllComponents();
                return stage.loadFile(input, {ext: 'pdb'}).then(function (o) {
                    o.autoView();
                    o.addRepresentation(polymerSelect.value, {
                        sele: "all",
                        name: "all",
                        colorScheme: "atomindex"
                    });
                    // o.addRepresentation("spacefill", {
                    //         sele: "ligand",
                    //         aspectRatio: 3.0
                    //     }
                    // );
                })
            }

            addElement(createElement("span", {
              innerText: "Representation: "
            }, { top: '70px', left: "20px" }))

            var polymerSelect = createSelect([
                ["cartoon", "Cartoon"],
                ["ribbon", "Ribbon"],
                ["rope", "Rope"],
                ["tube", "Tube"],
                ["trace", "Trace"],
                ["backbone", "Backbone"],
                ["line", "Lines"],
                ["ball+stick", "Ball & Stick"],
                ["licorice", "Licorice"],
                ["hyperball", "Hyperball"],
                ["surface", "Surface"],
                ["spacefill", "Spacefill"],
                ["helixorient", "Helixorient"],
                ["point", "Point"],
                ["rocket", "Rocket"],
                ["label", "Label"]
            ], {
                onchange: function (e) {
                    stage.getRepresentationsByName("all").dispose();
                    stage.eachComponent(function (o) {
                        o.addRepresentation(e.target.value, {
                            sele: "all",
                            name: "all",
                            colorScheme: colorSelect.value
                        })
                    })
                }
            }, {top: "100px", left: "20px"});
            addElement(polymerSelect);

            addElement(createElement("span", {
              innerText: "Color by: "
            }, { top: '150px', left: "20px" }))

            // Code to add a uniform color to scheme:
            // var lightgrey = NGL.ColormakerRegistry.addScheme(function (params) {this.atomColor = function (atom) {return 0xCDCDCD }})

            var colorSelect = createSelect([
              ['atomindex', 'Atom Index'],
              ['bfactor', 'B Factor'],
              ['chainid', 'Chain ID'],
              ['chainindex', 'Chain Index'],
              ['chainname', 'Chain Name'],
              ['element', 'Element'],
              ['entityindex', 'Entity Index'],
              ['entitytype', 'Entity Type'],
              ['geoquality', 'Geo Quality'],
              ['hydrophobicity', 'Hydrophobicity'],
              ['modelindex', 'Model Index'],
              ['moleculetype', 'Molecule Type'],
              ['occupancy', 'Occupancy'],
              ['random', 'Random'],
              ['residueindex', 'Residue Index'],
              ['resname', 'Residue Name'],
              ['sstruc', 'Secondary Structure'],
              // ['uniform', 'Uniform']
            ], {
              onchange: function(e) {
                stage.getRepresentationsByName("all").dispose();
                stage.eachComponent(function (o) {
                  o.addRepresentation(polymerSelect.value, {
                    sele: 'all',
                    name: 'all',
                    colorScheme: e.target.value
                  })
                })
              }
            }, {top: "180px", left: "20px"});
            addElement(colorSelect);

            var centerButton = createElement("input", {
                type: "button",
                value: "Center",
                onclick: function () {
                    stage.autoView(1000)
                }
            }, {top: "250px", left: "20px"});
            addElement(centerButton);

            var toggle_spin = true;
            var spinButton = createElement("input", {
                type: "button",
                value: "Spin",
                onclick: function () {
                    if (toggle_spin === false) {
                        stage.setSpin(true);
                        toggle_spin = true;
                        stage.setRock(false);
                        toggle_rock = false;
                        
                    } else if (toggle_spin === true) {
                        stage.setSpin(false);
                        toggle_spin = false;
                        console.log(toggle_spin);
                    }
                }
            }, {top: "300px", left: "20px"});
            addElement(spinButton);

            var toggle_rock = false;
            var rockButton = createElement("input", {
                type: "button",
                value: "Rock",
                onclick: function () {
                    if (toggle_rock === false) {
                        stage.setRock(true);
                        toggle_rock = true;
                        stage.setSpin(false);
                        toggle_spin = false;
                        
                    } else if (toggle_rock === true) {
                        stage.setRock(false);
                        toggle_rock = false;
                        console.log(toggle_rock);
                    }
                }
            }, {top: "350px", left: "20px"});
            addElement(rockButton);

            loadStructure("model1-repair.txt");
            stage.setSpin(true);

            $('select').addClass('btn btn-primary')
            $('input').addClass('btn btn-danger')

        </script>

    </body>
</html>